apiVersion: v1
kind: ConfigMap
metadata:
  name: guitartortona-api-config
data:
  application.yaml: |
    spring:
      application:
        name: guitartortona-api
    
      # Database configuration
      datasource:
        url: ${JDBC_URL}
        username: ${DB_USERNAME}
        password: ${DB_PASSWORD}
        driver-class-name: org.mariadb.jdbc.Driver
        hikari:
          maximum-pool-size: 10
          minimum-idle: 5
          connection-timeout: 30000
          idle-timeout: 600000
          max-lifetime: 1800000
          pool-name: GuitarTortonaApiHikariPool
    
      # JPA/Hibernate
      jpa:
        hibernate:
          ddl-auto: validate
        show-sql: false
        properties:
          hibernate:
            dialect: org.hibernate.dialect.MariaDBDialect
            format_sql: true
            use_sql_comments: true
            jdbc:
              batch_size: 20
            order_inserts: true
            order_updates: true
    
      # Flyway migrations
      flyway:
        enabled: true
        locations: classpath:db/migration
        baseline-on-migrate: true
        validate-on-migrate: true
    
    # Server configuration
    server:
      port: 8080
      compression:
        enabled: true
        mime-types: application/json,application/xml,text/html,text/xml,text/plain
      http2:
        enabled: true
      error:
        include-message: always
        include-binding-errors: always
    
    # Management/Actuator
    management:
      server:
        port: 8081
      endpoints:
        web:
          exposure:
            include: health,info,metrics,prometheus,loggers
          base-path: /actuator
      endpoint:
        health:
          show-details: always
          probes:
            enabled: true
      metrics:
        export:
          prometheus:
            enabled: true
        tags:
          application: ${spring.application.name}
          environment: ${ENVIRONMENT:default}
    
    # Logging
    logging:
      level:
        root: INFO
        com.guitartortona.api: DEBUG
        org.springframework.web: INFO
        org.hibernate.SQL: DEBUG
        org.hibernate.type.descriptor.sql.BasicBinder: TRACE
      pattern:
        console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    
    # Application specific
    app:
      cors:
        allowed-origins: "*"
        allowed-methods: GET,POST,PUT,DELETE,OPTIONS
        allowed-headers: "*"
        allow-credentials: true
      jwt:
        secret: ${JWT_SECRET:default-secret-change-me}
        expiration: 86400000